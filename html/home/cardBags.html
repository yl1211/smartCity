<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../../layui/css/layui.css" />
	<link rel="stylesheet" href="../../css/base.css" />
	<link rel="stylesheet" href="../../css/card.css" />
	<!-- <link rel="stylesheet" href="../../css/layer.css" /> -->
	<title>卡包</title>
</head>

<body>
	<div class="layui-fluid">
		<div class="layui-row bagContent">
			<h2 class="file-title">
				<a href="javascript:history.back(-1);" class="back">
					<i class="layui-icon layui-icon-left"></i> 返回
				</a>
				卡包
				<a href="addCard.html" class="add"><i class="layui-icon right" style="">&#xe654;</i></a>
			</h2>
			<!--卡包信息-->
			<div class="layui-row transitCardBox " id="viewContent">
			</div>
		</div>
		<!--点击“解绑”出现的弹窗内容-->
		<div class="opendiv" id="opendiv" data-method="offset" data-type="c">
			<h3 class="untyTitle">确定解绑？</h3>
			<hr />
			<button type="button" class="cancel" id="cancel">取消</button>
			<button type="button" class="untying" id="untying">解绑</button>
		</div>
	</div>

	<script type="text/javascript" src="../../js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="../../js/jquery.base64.js"></script>
	<script type="text/javascript" src="../../js/url.js"></script>
	<script type="text/javascript" src="../../js/getparameter.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script>
		layui.use(['laytpl', 'layer'], function () {
			var laytpl = layui.laytpl;
			var layer = layui.layer;

			//获取上级页面url的参数
			// $(document).ready(function () {
			// 	var a = GetRequest();
			// 	var id = a['id'];
			// 	var token = a['token'];
			// 	console.log(id);
			// 	console.log(token);
			// })


			//获取银行卡信息
			$(function () {
				$.ajax({
					url: globalurl + '/appcard/appCardList',
					type: 'post',
					data: {

					},
					// headers: {
					// 	"token": token         //此处放置请求到的用户token
					// },
					dataType: 'json',
					success: function (res) {
						var value = JSON.parse($.base64.decode(res.data));   //base64解密
						console.log(value);
						var cardStr = '';
						for (var i = 0; i < value.length; i++) {
							cardStr += "<div class='layui-col-xs12 layui-col-xs-offset1 transitCard'><p class='title'><img src='../../img/logo.jpg'>广西农信信用社</p><p class='cardName'><span>" + value[i].type + "</span></p><p class='cardNum'>" + value[i].cardnum + "</p></div>"

						}
						$("#viewContent").append(cardStr);

						//确认是否删除银行卡的弹窗
						$(document).on("click", ".transitCard", function (cardnum) {
							var cardNum = $(this).children('.cardNum').html();
							var cardnum = $.trim(cardNum).replace(/\s/g, "");
							console.log(cardnum);
							layer.confirm('', {
								title: false,
								closeBtn: false,
								area: '90%;',
								type: 1,
								shift: -1,
								offset: 'b',
								shadeClose: true,
								btn: ['解绑', '取消'] //按钮
							}, function () {
								var index = layer.open({
									title: false,
									closeBtn: false,
									area: '50%;',
									type: 1,
									shift: -1,
									offset: 'auto', //位置
									shadeClose: true,
									content: $('#opendiv')
								})
							});
						});
						$(".cancel").on('click', function () {
							layer.closeAll();
						});
						//点击解绑时
						// $("#untying").on('click', function (data) {
						$(document).on("click", "#untying", function (cardnum) {
							var cardNum = $(this).children('.cardNum').html();
							var cardnum = $.trim(cardNum).replace(/\s/g, "");
							console.log(cardnum);
							$.ajax({
								url: globalurl + '/appcard/unBindCard',
								type: 'post',
								data: {
									cardnum: cardnum
								},
								// headers: {
								// 	"token": token         //此处放置请求到的用户token
								// },
								dataType: 'json',
								// async: false,
								success: function (data) {
									if (data.code == "0000") {
										console.log(data);
										// var index = layer.msg("解绑成功", {
										// 	time: 2000
										// });
										layer.msg(data.msg);

										layer.close("#opendiv");
										layer.close(layer.index - 1);
										layer.close(layer.index - 2);
										function g() {
											window.location.href = window.location.href;   //删除之后进行页面刷新操作
										}
										//使用js计时器功能
										setInterval(g, 3000);
									} else {
										layer.msg(data.msg);
									}
									layer.close("#opendiv");
									layer.close(layer.index - 1);
									layer.close(layer.index - 2);
								}
							})

						});

					}
				})

			});
		})



	</script>

</body>

</html>